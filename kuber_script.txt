# Initialization part, done once:

# Install k3s
curl -sfL https://get.k3s.io | sh -

# Handle config a bit
export KUBECONFIG=/etc/rancher/k3s/k3s.yaml

# Check that it works
sudo kubectl get nodes

# Install Kompose
sudo snap install kompose

# Convert docker-compose (check version in .yml)
sudo kompose convert -f docker-compose.yml

# Add 
# ```
# 	spec:
#  		type: NodePort
# ```
# in frontend-service.yaml to be able to access front

# Apply to Kubernetes
sudo kubectl apply -f .

# Check everything 
sudo kubectl get pods
sudo kubectl get svc

# Regularly:

# Launch pods 
sudo kubectl scale deployment frontend --replicas=1
sudo kubectl scale deployment backend --replicas=1
sudo kubectl scale deployment postgres --replicas=1

# Stop them
sudo kubectl scale deployment frontend --replicas=0
sudo kubectl scale deployment backend --replicas=0
sudo kubectl scale deployment postgres --replicas=0